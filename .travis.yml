sudo: require

language: java

services:
  - docker

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_PULL_REQUEST" = "false" ]; then
    set -e;
    docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";

    export BACKEND_REPO=$DOCKER_ORGANIZATION/resume-builder-bot;
    docker build -t $BACKEND_REPO:$TRAVIS_COMMIT .;
    docker tag $BACKEND_REPO:$TRAVIS_COMMIT $BACKEND_REPO:latest;

    export POSTGRES_REPO=$DOCKER_ORGANIZATION/resume-builder-bot-postgres;
    docker build -f Dockerfile.postgres -t $POSTGRES_REPO:$TRAVIS_COMMIT .;
    docker tag $POSTGRES_REPO:$TRAVIS_COMMIT $POSTGRES_REPO:latest;

    docker push $BACKEND_REPO:latest;
    docker push $POSTGRES_REPO:latest;
    fi

branches:
  only:
  - master

notifications:
  slack:
    secure: uzxYCqbcgkKfpev66vhjlHPZWbVzcsWgKqDtOxc+arvm0MRlYifnaTerf+BcM14OVZfs4lePSJepPLUgl1rUABp8Sz/vmn1h85AoZxvHSrNWrePNs/TAkCaSPrw4NT/x/m5jLHI6xOdk3lhU6yBcNNA49RqSrtISaPBsLKDtL40HSZxSitwwZgz/j4dU2qdjPgkKctX4FpbxEbkUfZ3V4rgCdnZ2Pv2XIlTJm2k547NFcuE6B4HFZm5o8/bopV4Rk6UUyg0GCorS9I6+gmCbMryA89ednHZ7+N6gB+UmfqCQ6B/PQvFlRYxyB1H7yF3bl1TaXcto1CpTFrbMbhgYGH9l0AtKW2L32ZDesPTY5B8NzhceCSNJ0bWW+JfcwQbpuhyu+MIQedfTbv1E5zy5zRzmzFk+f+IZTe9ETKjZwbRJe3Lmp7zL2RFtXdtPl2tRqaJkEMCSm8SELW47fm97Rr/4qJ4sd+wrmYd5nxaMuguE89PcSSKmLH2SAiBJ3sEIl37ms3b5rr0idrPOXqCYxnBurbxWFu5oRjnVaEUTqPzkS37okmpcIbvuXcJhbJ79AOs604I6L0ROvLWYlWxuVhNkUrtURsUQcCuxUkiXJdYLFGMc2fwz2o5fvSre/SkkgXx2lhjK/l67bPo6cBppgPXWw5DtOOsX/1I39x1KQ1A=
    on_success: change
